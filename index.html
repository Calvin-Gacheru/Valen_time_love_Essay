<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For King SK ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* CSS: The Visuals */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(-45deg,#ee9ca7,#ff9a9e, #fad0c4, #ffdde1, #ff512f, #dd2476, #ff00cc, #6a11cb);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .phone-container {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            width: 90%; 
            max-width: 400px;
            padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            position: relative;
        }

        #password-gate { text-align: center; color: white; }

        input[type="password"] { 
            padding: 10px; border-radius: 5px; border: none; margin-bottom: 10px; width: 80%; 
        }

        button.unlock-btn { 
            background: #ff4b4b; color: white; border: none; padding: 10px 20px; 
            border-radius: 20px; cursor: pointer; font-weight: bold; font-size: 1em;
        }

        .progress-bar { 
            font-style: italic; text-shadow: 1px 1px 2px rgba(106, 17, 203, 0.3);
            background: #fff; color: #6a11cb; padding: 10px; border-radius: 10px; 
            text-align: center; font-weight: bold; margin-bottom: 15px; 
        }
        
        .card { 
            background: rgba(255, 255, 255, 0.4); 
            padding: 20px; border-radius: 30px; text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            min-height: 400px; display: flex; flex-direction: column; 
            justify-content: center; position: relative; 
        }
        
        #quiz-container { display: none; flex-direction: column; }
        .question-text { font-size: 1.2em; margin-bottom: 20px; font-weight: 600; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        
        textarea {
            width: 90%; margin: 0 auto; background: rgba(255,255,255,0.7);
            border: 2px solid #fff; border-radius: 15px; padding: 15px;
            font-family: 'Poppins', sans-serif; font-size: 1em; color: #333;
            resize: none; outline: none; transition: 0.3s;
        }
        textarea:focus { background: rgba(255,255,255,0.95); box-shadow: 0 0 15px rgba(255, 255, 255, 0.5); }

        .next-btn {
            margin-top: 20px; background: #6a11cb; color: white; border: none;
            padding: 12px 30px; border-radius: 50px; font-size: 1.1em;
            cursor: pointer; font-weight: bold; transition: 0.3s;
        }

        #proposal-container { 
            font-size: 1.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            font-family: 'Pacifico', cursive; display: none; flex-direction: column;
            justify-content: center; position: relative;
        }
        .btn-group { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
        
        .yes-btn { 
            background-color: #32cd32; color: white; padding: 15px 40px; 
            border: none; border-radius: 50px; font-weight: bold; font-size: 1.3em; 
            animation: pulse 2s infinite; cursor: pointer;
        }
        .no-btn { 
            background-color: #ff3b3b; color: white; padding: 15px 40px; 
            border: none; border-radius: 50px; font-weight: bold; cursor: pointer; 
            font-size: 1.3em; transition: all 0.3s ease; 
        }

        #success-container { display: none; flex-direction: column; }
        #loading-overlay { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100%; }

        /* Animation Keyframes */
        @keyframes pulse { 0% { transform: scale(1); } 70% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes heartbeat { 0% { transform: scale(1); } 15% { transform: scale(1.05); } 30% { transform: scale(1); } 45% { transform: scale(1.05); } 60% { transform: scale(1); } 100% { transform: scale(1); } }
        @keyframes fall-heart { 0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; } 10% { opacity: 1; } 100% { transform: translateY(110vh) rotate(360deg); opacity: 0; } }
        @keyframes animate { 0%{ transform: translateY(0) rotate(0deg); opacity: 1; border-radius: 0; } 100%{ transform: translateY(-1000px) rotate(720deg); opacity: 0; border-radius: 50%; } }

        /* Background Layers */
        .circles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; margin: 0; padding: 0; z-index: -1; }
        .circles li { position: absolute; display: block; list-style: none; width: 20px; height: 20px; color: rgba(255, 255, 255, 0.7); bottom: -150px; animation: animate 25s linear infinite; }
        
        #bg-layer-1 li:nth-child(1){ left: 25%; font-size: 80px; }
        #bg-layer-1 li:nth-child(2){ left: 10%; font-size: 40px; animation-duration: 12s; }
        #bg-layer-1 li:nth-child(3){ left: 70%; font-size: 40px; }
        #bg-layer-1 li:nth-child(4){ left: 40%; font-size: 100px; animation-duration: 18s; }
        #bg-layer-1 li:nth-child(5){ left: 65%; font-size: 40px; }
        #bg-layer-1 li:nth-child(6){ left: 75%; font-size: 150px; animation-delay: 3s; }
        #bg-layer-1 li:nth-child(7){ left: 35%; font-size: 200px; animation-delay: 7s; }
        #bg-layer-1 li:nth-child(8){ left: 50%; font-size: 50px; animation-duration: 45s; }
        
        #bg-layer-2 li { width: auto; height: auto; font-weight: bold; color: rgba(255, 255, 255, 0.9); font-family: sans-serif; }
        #success-container .card { background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 0 30px rgba(255, 255, 255, 0.5); color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.3); animation: heartbeat 1.5s infinite; }
        
        #heart-confetti { position: fixed; inset: 0; pointer-events: none; overflow: hidden; z-index: 300; }
        .confetti-heart { position: absolute; top: -10%; font-size: 22px; opacity: 0.9; animation: fall-heart 6s linear forwards; }
    </style>
</head>
<body>
    <ul class="circles" id="bg-layer-1">
        <li>‚ù§Ô∏è</li> <li>üíñ</li> <li>ü§ç</li> <li>üíò</li> <li>üíù</li>
        <li>‚ù§Ô∏è</li> <li>üíñ</li> <li>ü§ç</li> <li>üíò</li> <li>üíù</li>
    </ul>
    <ul class="circles" id="bg-layer-2" style="display: none;"></ul>

    <div id="music-player" style="position: absolute; top: -9999px; left: -9999px; opacity: 0; pointer-events: none;"></div>

    <div class="phone-container">

        <div id="password-gate">
            <h2>üîí Top Secret Love</h2>
            <p>Enter the password to start.</p>
            <input type="password" id="password-input" placeholder="Enter Password">
            <br>
            <button class="unlock-btn" onclick="checkPassword()">Unlock</button>
            <p id="error-msg" style="color: #ff6b6b; font-size: 0.8em; display: none;">Wrong password!</p>
        </div>

        <div id="quiz-container">
            <div class="progress-bar">Question <span id="current-q-num">1</span> of <span id="total-questions">15</span></div>
            <div class="card">
                <div class="question-text" id="question-text">Loading...</div>
                <textarea id="answer-input" rows="4" placeholder="Type your answer here, King..."></textarea>
                <button class="next-btn" onclick="nextQuestion()">Next üíñ</button>
            </div>
        </div>

        <div id="proposal-container" style="display:none; flex-direction: column;">
            <div class="card" id="proposal-card-content">
                <h2 id="proposal-question" style="margin-bottom: 20px; line-height: 1.4;">Mfalme,<br>will you be my Valentine?</h2>
                <div class="btn-group">
                    <button class="yes-btn" id="yes-btn" onclick="handleProposal('yes')">Yes ‚ù§Ô∏è</button>
                    <button class="no-btn" id="no-btn" onclick="handleNoClick()">No</button>
                </div>
            </div>
            <div id="loading-overlay">
                <h3 style="color: white;">Sending your love... ‚ù§Ô∏è</h3>
            </div>
        </div>

        <div id="success-container" style="display: none; flex-direction: column;">
            <div class="card">
                <h2>üéâ Yay! ‚ù§Ô∏è üéâ</h2>
                <p style="font-size: 40px; margin: 10px 0;">ü•Çü•∞</p>
                <p style="font-weight: bold; color: #fff;">Answers Saved!</p>
                <p style="font-size: 0.9em;">I love you, King SK.</p>
            </div>
        </div>

    </div>

    <div id="heart-confetti"></div>
    
    <script>
        // --- CONFIGURATION ---
        const CORRECT_PASSWORD = "4338"; 
        
        // --- GOOGLE SHEETS URL (PASTE YOUR DEPLOYED WEB APP URL HERE) ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz6fhoi1jE4bmnecaFop1C666koTQmm8-wVKfiVk75S08a42aR8Q0z4FrTB9KFc5OOg/exec"; 


        // --- YOUTUBE MUSIC ID ---
        let MUSIC_ID = "EhXdOmA1abw"; 

        // --- DATA ---
        const questionList = [
            "King SK, When did you realize I wasn‚Äôt ‚Äújust someone you were dating‚Äù?",
            "What song reminds you of us?",
            "What‚Äôs your favorite thing we do together that seems small but feels big?",
            "What‚Äôs one word you‚Äôd use to describe us?",
            "What‚Äôs my most adorable habit (be honest)?",
            "What do I do that instantly makes your day better?",
            "What‚Äôs your favorite memory of us so far?",
            "What‚Äôs your favorite way I show affection?",
            "When do you feel most connected to me?",
            "What‚Äôs your favorite way for us to end a long day together?",
            "How do I make your life better?",
            "What‚Äôs something you‚Äôre excited about with us this year?",
            "King‚Ä¶ are you smiling yet?",
            "Do you know how much you mean to me?",
            "Are you ready for one last question?"
        ];

        let collectedAnswers = [];
        let currentQuestionIndex = 0;
        let player; 
        let currentMood = 'normal';

        // --- STARTUP ---
        window.onload = function() {
            document.getElementById('total-questions').textContent = questionList.length;
            loadYoutubeScript();
        };

        // --- YOUTUBE LOGIC ---
        function loadYoutubeScript() {
            var tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            var firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }

        function onYouTubeIframeAPIReady() {
            if(MUSIC_ID) {
                player = new YT.Player('music-player', {
                    height: '0', width: '0', videoId: MUSIC_ID,
                    playerVars: { 
                        'autoplay': 1, 'controls': 0, 'loop': 1, 
                        'playlist': MUSIC_ID, 'playsinline': 1, 'enablejsapi': 1,
                        'origin': window.location.origin
                    },
                    events: { 
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            }
        }

        function onPlayerReady(event) {
            event.target.playVideo();
            event.target.setVolume(50);
        }
 
        // function onPlayerStateChange(event) {
        //      if (event.data === YT.PlayerState.UNSTARTED || event.data === -1) {
        //         document.body.addEventListener('click', function() {
        //             player.playVideo();
        //             player.unMute();
        //         }, { once: true });
        //      }
        // }     

        function onPlayerStateChange(event) {
            // If the video hasn't started yet...
            if (event.data === YT.PlayerState.UNSTARTED || event.data === -1) {
                
                // 1. Define the trigger function
                const forcePlay = function() {
                    if(player) {
                        player.playVideo();
                        player.unMute(); // Crucial for iPhones
                    }
                    
                    // 2. Cleanup: Remove listeners so it doesn't keep firing
                    document.body.removeEventListener('click', forcePlay);
                    document.body.removeEventListener('touchstart', forcePlay);
                };

                // 3. Listen for EITHER a Click (Desktop) OR a Touch (Mobile)
                document.body.addEventListener('click', forcePlay);
                document.body.addEventListener('touchstart', forcePlay);
            }
        }
        // --- APP LOGIC ---
        function checkPassword() {
            const input = document.getElementById('password-input').value;
            if(input === CORRECT_PASSWORD) {
                document.getElementById('password-gate').style.display = 'none';
                document.getElementById('quiz-container').style.display = 'flex';
                loadQuestion();
                if(player && typeof player.playVideo === 'function') player.playVideo();
            } else {
                document.getElementById('error-msg').style.display = 'block';
            }
        }

        function loadQuestion() {
            document.getElementById('question-text').textContent = questionList[currentQuestionIndex];
            document.getElementById('current-q-num').textContent = currentQuestionIndex + 1;
            document.getElementById('answer-input').value = "";
            document.getElementById('answer-input').focus();
        }

        function nextQuestion() {
            const inputVal = document.getElementById('answer-input').value;
            if(inputVal.trim() === "") { alert("Please write something! ü•∫"); return; }

            collectedAnswers.push({
                question: questionList[currentQuestionIndex],
                answer: inputVal
            });

            currentQuestionIndex++;

            if (currentQuestionIndex < questionList.length) {
                loadQuestion();
            } else {
                document.getElementById('quiz-container').style.display = 'none';
                document.getElementById('proposal-container').style.display = 'flex';
            }
        }

        // --- PROPOSAL LOGIC ---
        function handleNoClick() {
            if(currentMood !== 'sad'){ setMood('sad'); }
            const noBtn = document.getElementById('no-btn');
            const card = document.querySelector('#proposal-container .card');
            const maxX = card.clientWidth - noBtn.offsetWidth;
            const maxY = card.clientHeight - noBtn.offsetHeight;
            noBtn.style.position = 'absolute';
            noBtn.style.left = Math.floor(Math.random() * maxX) + 'px';
            noBtn.style.top = Math.floor(Math.random() * maxY) + 'px';
        }

        function handleProposal(answer) {
            if (answer === 'yes') {
                document.getElementById('proposal-card-content').style.display = 'none';
                document.getElementById('loading-overlay').style.display = 'flex';
                
                // SEND TO GOOGLE SHEETS
                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // IMPORTANT for Google Sheets
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(collectedAnswers)
                })
                .then(response => {
                    // Even with no-cors, we assume success if no error thrown
                    console.log("Sent to Sheets");
                    showSuccess();
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert("The internet is acting up, but I still love you! (Screenshot this!)");
                    showSuccess();
                });
            }
        }

        function showSuccess() {
            document.getElementById('proposal-container').style.display = 'none';
            document.getElementById('success-container').style.display = 'flex';
            setMood('happy');
            launchHeartConfetti();
        }

        // --- VISUALS ---
        const moods = {
            happy: ['‚ù§Ô∏è', 'üíñ', 'I‚ù§Ô∏èU', 'Love You', 'ü•∞', 'Forever', 'You&Me', 'üíò', 'üíï', 'ü´Ç', 'ü§ó'],
            sad: ['üíî', 'üò¢', 'üòî', 'üòü', '‚òπÔ∏è', 'ü•∫', 'ü•π', 'üòì', 'üòû', 'üòñ', 'üò≠', 'üò¢', 'üò•', 'ü•Ä']
        };

        function setMood(moodType) {
            currentMood = moodType;
            document.getElementById('bg-layer-1').style.display = 'none';
            const layer2 = document.getElementById('bg-layer-2');
            layer2.style.display = 'block';
            layer2.innerHTML = ''; 
            const items = moods[moodType];
            for(let i = 0; i < 20; i++) {
                const li = document.createElement('li');
                li.textContent = items[Math.floor(Math.random() * items.length)];
                li.style.left = Math.random() * 90 + '%';
                li.style.fontSize = (20 + Math.random() * 30) + 'px'; 
                li.style.animationDelay = (Math.random() * 5) + 's';
                li.style.animationDuration = (10 + Math.random() * 10) + 's';
                layer2.appendChild(li);
            }
        }

        function launchHeartConfetti() {
            const confetti = document.getElementById('heart-confetti');
            const count = 25; 
            const hearts = ['‚ù§Ô∏è', 'üíñ', 'üíò', 'üíï', 'üåπ', 'ü•Ä', 'üå∫', 'üåª', 'üåº', 'üå∑', 'üíê'];
            function spawnHeart(i) {
                const heart = document.createElement('div');
                heart.className = 'confetti-heart';
                heart.textContent = hearts[i % hearts.length];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDelay = (Math.random() * 0.8).toFixed(2) + 's';
                heart.style.animationDuration = (5 + Math.random() * 3).toFixed(2) + 's';
                heart.style.fontSize = (18 + Math.random() * 16) + 'px';
                confetti.appendChild(heart);
                setTimeout(() => { heart.remove(); }, 9000);
            }
            for (let i = 0; i < count; i++) spawnHeart(i);
            let i = count;
            const intervalId = setInterval(() => { spawnHeart(i); i += 1; }, 350);
            setTimeout(() => { clearInterval(intervalId); }, 12000);
        }
    </script>
</body>
</html>